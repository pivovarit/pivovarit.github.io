<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>reveal.js</title>

    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="dist/theme/simple.css">

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="plugin/highlight/agate.css">
</head>
<body>
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-109711864-1', 'pivovarit.github.io');
    ga('send', 'pageview');

</script>
<div class="reveal">

    <div class="slides">
        <section>
            <h2>Embracing Microservices</h2>
            <h4><a href="http://pivovarit.github.io"> Grzegorz Piwowarek</a></h4>
            <h5><a href="http://twitter.com/pivovarit">@pivovarit</a></h5>
            <img class="fragment" src="img/embarrasing.png" width="60%"/>
        </section>

        <section>
            <h2>{ <a href="http://4comprehension.com/">4comprehension.com</a> }</h2>
            <h4>Founding Engineer @ Quesma</h4>
            <h4>Owner @ 4Comprehension</h4>
            <h4>WarsawJUG Leader</h4>
            <h5><a href="http://twitter.com/pivovarit">@pivovarit</a></h5>
            <br>
        </section>

        <section>
            <h2>Questions? </h2>
            <h3>sli.do #geecon</h3>
        </section>

        <section>
            <img src="img/snake.jpg" width="70%"/>
        </section>

        <section data-transition="fade">
            <img src="img/microservices.jpeg" width="80%"/>
            <small><a href="https://twitter.com/ddprrt/status/1425418538257428488">https://twitter.com/ddprrt/status/1425418538257428488</a></small>
        </section>

        <section data-transition="fade">
            <img src="img/microservices-2.jpeg" width="80%"/>
            <small><a href="https://twitter.com/ddprrt/status/1425418538257428488">https://twitter.com/ddprrt/status/1425418538257428488</a></small>
        </section>

        <section>
            <img src="img/hoare.jpg" width="30%"/>
            <blockquote
                    cite="https://www.infoq.com/presentations/Null-References-The-Billion-Dollar-Mistake-Tony-Hoare/">
                "It was the invention of the null reference in 1965...I call it my billion-dollar mistake."
            </blockquote>
            <small>Tony Hoare</small>
        </section>

        <section>
            <img src="img/future-null.jpg" width="60%"/>
        </section>



        <section data-transition="fade">
            <h4>Another <em>"billion-dollar mistake":</em></h4>
            <h3 class="fragment">Microservices</h3>
        </section>

        <section data-transition="fade">
            <h4>Another <em>"billion-dollar mistake":</em></h4>
            <h3>"Micro"</h3>
        </section>

        <section data-transition="fade">
            <h3>Antipattern #1: Size Obsession</h3>
            <h4 class="fragment">Microservice vs service?</h4>
            <h4 class="fragment">How small is "micro"?</h4>
            <h5 class="fragment">N lines of code?</h5>
            <h5 class="fragment">N classes?</h5>
            <h5 class="fragment">N MBs?</h5>
            <h5 class="fragment">Rewritable in X time?</h5>
        </section>

        <section>
            <h4>Microservices: the Main Idea</h4>
            <h3 class="fragment">Enable scalability through independence and modularity</h3>
        </section>

        <section data-transition="fade">
            <h4>Tight coupling - Low cohesion</h4>

            <img src="img/tight-coupling.png" width="50%"/>
            <br>
            <small>source: <a href="https://enterprisecraftsmanship.com/posts/cohesion-coupling-difference/">https://enterprisecraftsmanship.com/posts/cohesion-coupling-difference/</a></small>
        </section>
        <section data-transition="fade">
            <h4>Low coupling - High cohesion</h4>

            <img src="img/loose-coupling.png" width="50%"/>
            <br>
            <small>source: <a href="https://enterprisecraftsmanship.com/posts/cohesion-coupling-difference/">https://enterprisecraftsmanship.com/posts/cohesion-coupling-difference/</a></small>
        </section>

        <section>
            <h4>Don't vendor-lock yourself, but if you do... call us.</h4>
            <img src="img/quesma.png" width="70%"/><br>
            <small><a href="quesma.com">quesma.com</a></small>
        </section>

        <section>
            <h4>You can have modularity without microservices</h4>
            <img class="fragment" src="img/monolith.png" width="40%"/>
            <h5 class="fragment">Naturally, you don't get all the benefits, but it's not a demanding investment</h5>
        </section>

        <section>
            <img src="img/evolution.png" width="70%"/>
        </section>

        <section>
            <blockquote cite="Building Microservices by Sam Newman">
                "The smaller the service, the more you maximize the benefits and downsides of microservice architecture."
            </blockquote>
            <small>Sam Newman</small>
        </section>

        <section>
            <img src="img/netflix.png" width="70%"/>
            <br>
            <small>author: Bruce Wong</small>
            <h3 class="fragment">Netflix: 2000 engineers</h3>
        </section>

        <section>
            <img src="img/boat.png" width="50%"/>
        </section>

        <section>
            <blockquote cite="'How Netflix Really Uses Java' by Paul Bakker" width="100%">
                However, don't be fooled by the size of those microservices, because a lot of those so-called microservices at Netflix are a lot larger, just looking at the code base, than the big monoliths that I've worked at, at many other companies.
            </blockquote>
            <small>Paul Bakker,</small>
            <small> source: <a href="https://www.infoq.com/presentations/netflix-java/">https://www.infoq.com/presentations/netflix-java/</a></small>
        </section>

        <section>
            <h5>Do not ask about the max size, but when to split</h5>
        </section>

        <section>
            <h5>So... when do we split?</h5>
            <br>
            <h5 class="fragment">When it hurts too much</h5>
            <h5 class="fragment">The #1 rule of distributed systems: don't do it until you have to</h5>
        </section>

        <section>
            <h3>The Pragmatic Default</h3>
            <img src="img/citadel.png" width="50%"/>
            <small><a href="https://twitter.com/dhh/status/1247522358908215296</small">https://twitter.com/dhh/status/1247522358908215296</a></small>
        </section>

        <section>
            <blockquote cite="'Static Analysis at Scale: An Instagram Story' by Benjamin Woodruff" width="100%">
                Our server app is a monolith, one big codebase of several million lines and a few thousand Django endpoints [1], all loaded up and served together. A few services have been split out of the monolith, but we donâ€™t have any plans to aggressively break it up.
            </blockquote>
            <small><a href="https://instagram-engineering.com/static-analysis-at-scale-an-instagram-story-8f498ab71a0c">https://instagram-engineering.com/static-analysis-at-scale-an-instagram-story-8f498ab71a0c</a></small>
        </section>

        <section>
            <h3>Antipattern #2: Old Habits Die Hard</h3>
            <h5 class="fragment">Single version for all services</h5>
            <h5 class="fragment">All-or-nothing deployments</h5>
            <h5 class="fragment">Dedicated "DevOps" bottleneck teams</h5>
            <h5 class="fragment">End-to-end Acceptance tests</h5>
        </section>

        <section>
            <blockquote cite="Building Microservices by Sam Newman">
                "Can you make a change to a service and deploy it by itself without changing anything else?
                If the answer is no, then many of the advantages we discuss throughout this book will be hard for you to
                achieve."
            </blockquote>
            <small>Sam Newman</small>
        </section>

        <section>
            <h3>Monorepos</h3>
            <h5 class="fragment">make it easy to stick to old habits</h5>
            <h5 class="fragment">- require extra discipline</h5>
            <h5 class="fragment">- require extra tooling</h5>
        </section>

        <section>
            <h4>Antipattern #3</h4>
            <h3>Not Embracing Eventual Consistency</h3>

            <h6>So you have 150 services and they all need to be up and responsive at the same time for the whole system to work?</h6>
        </section>

        <section>
            <h3>Sync vs Async</h3>
            <h4 class="fragment">Both are good choice if you understand trade-offs</h4>
            <h5 class="fragment">Consistency vs Availability</h5>
            <br>
            <h4 class="fragment">Want to be fully independent? Forget about Strict Consistency</h4>
        </section>

        <section data-transition="fade">
            <img src="img/sync1.png" width="80%"/>
        </section>

        <section data-transition="fade">
            <img src="img/sync2.png" width="80%"/>
        </section>

        <section>
            <h4>Antipattern #4:</h4>
            <h3>Accidental Consistency</h3>
            <h5>Eventual Consistency != Accidental Consistency</h5>
        </section>

        <section data-transition="fade">
            <img src="img/dual-write.png" width="60%"/>
        </section>

        <section data-transition="fade">
            <img src="img/dual-write-2.png" width="60%"/>
        </section>

        <section>

            <pre><code class="hljs language-java" data-trim data-noescape>
                @Transactional
                public void createUser(CreateUserCommand command) {
                    var user = from(command);

                    persist(user);                     // 1
                    send(UserCreatedEvent.from(user)); // 2
                }
            </code></pre>
            <h4><code>@Transactional</code> won't save you in the distributed world</h4>
        </section>

        <section data-transition="fade">
            <h4>Dual-Write (distributed transaction)</h4>
            <img src="img/cdc3.png" width="50%"/>
        </section>

        <section data-transition="fade">
            <h4>Singe-Write with async propagation</h4>
            <img src="img/cdc4.png" width="50%"/>
        </section>

        <section>
            <h4>Transactional Outbox Pattern</h4>
            <h4>Change Data Capture</h4>
        </section>

        <section>
            <h4>Antipattern #5:</h4>
            <h3>Technology Heterogeneity</h3>
            <img src="img/goldblum.jpeg" width="70%"/>
        </section>

        <section>
            <h4>Sounds great on paper</h4>
            <h5 class="fragment">Don't throw in new tech unless there's a good reason for it</h5>
            <h5 class="fragment">Most companies will benefit more from standardized tech stacks with occasional experiments</h5>
        </section>

        <section>
            <h5>Antipattern #6:</h5>
            <h3>DRY abuse and Shared Libraries </h3>
            <h4 class="fragment">Sound like a noble effort</h4>
            <h4 class="fragment">Can contribute to dependency hell</h4>
            <h4 class="fragment">A small change can result in N deployments</h4>
            <h4 class="fragment">Need to be treated like libraries and not bags with code</h4>
            <h4 class="fragment">Dangerous when business logic sneaks in</h4>
        </section>

        <section>
            <h3>REST API Contract as Java Classes</h3>
            <h4 class="fragment">Classes are not contract DSLs, need to be interpreted, results can vary</h4>
            <h4 class="fragment">DTOs-per-consumer is bulletproof, but requires a bit of boilerplate</h4>
            <h4 class="fragment">records reduce that boilerplate to minimum</h4>
        </section>

        <section>
            <h3>Summary</h3>
            <h5 class="fragment">Do not start with microservices, split existing services when absolutely necessary</h5>
            <h5 class="fragment">You're now working with N independent systems, stop treating them like they are one</h5>
            <h5 class="fragment">You're now prone to Fallacies of Distributed Computing - embrace Eventual Consistency</h5>
            <h5 class="fragment">Pay attention to guarantees of your system - At-Most-Once and Accidental Consistency might not be good enough</h5>
            <h5 class="fragment">Add new tech only when there's a good reason to do it</h5>
        </section>

        <section>
            <h4>Thank You!</h4>
            <h4><a href="http://twitter.com/pivovarit">@pivovarit</a></h4>
            <small><a href="https://4comprehension.com">4comprehension.com</a></small>
            <br>
            <img src="img/qrcode.png" width="40%"/>
            <br>
            <small><a href="https://pivovarit.github.io/talks/embracing-microservices">https://pivovarit.github.io/talks/embracing-microservices</a></small>
        </section>
    </div>
</div>

<script src="dist/reveal.js"></script>
<script src="plugin/notes/notes.js"></script>
<script src="plugin/markdown/markdown.js"></script>
<script src="plugin/highlight/highlight.js"></script>
<script>
    // More info about initialization & config:
    // - https://revealjs.com/initialization/
    // - https://revealjs.com/config/
    Reveal.initialize({
        hash: true,

        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [RevealMarkdown, RevealHighlight, RevealNotes]
    });
</script>
</body>

</html>
