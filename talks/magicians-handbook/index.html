<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>reveal.js</title>

    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="dist/theme/simple.css">

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="plugin/highlight/zenburn.css">

    <!--    <link rel="stylesheet" href="plugin/highlight/monokai.css">-->
</head>
<body>
<div class="reveal">
    <div class="footer">socials: <a href="http://twitter.com/pivovarit">@pivovarit</a></div>
    <div class="slides">
        <section>
            <h3>The Magician's Handbook</h3>
            <h4>Inside Java Framework Sorcery</h4>
            <br><br>
            <h4><a href="https://pivovarit.github.io"> Grzegorz Piwowarek</a></h4>
            <h5><a href="https://twitter.com/pivovarit">@pivovarit</a></h5>
        </section>

        <section>
            <h2>{ <a href="http://4comprehension.com/">4comprehension.com</a> }</h2>
            <h4>Independent Consultant/Trainer</h4>
            <small>distributed systems | microservices | async | reactive | java | idiomatic go</small>
            <h4>WarsawJUG | Vavr Leader | Oracle ACE</h4>
            <h5><a href="https://twitter.com/pivovarit">@pivovarit</a></h5>
            <br>
        </section>

        <section>
            <p><em>What’s really happening under the hood?</em></p>
        </section>

        <section>
            <h2>Component Discovery</h2>
            <ul>
                <li>Spring scans packages for components</li>
                <li>Uses a <strong>custom classloader</strong></li>
                <li>Inspects classes using reflection and metadata readers</li>
                <li>Spring AOT speeds up startup by avoiding runtime reflection (experimental)</li>
            </ul>
        </section>

        <section>
            <h2>Classpath Scanning & Reflection</h2>
            <ul>
                <li>Classpath scanning + reflection is <strong>slow</strong></li>
                <li>Bytecode manipulation is used for performance</li>
                <li>Libraries:
                    <ul>
                        <li><strong>ClassGraph</strong> – scanning</li>
                        <li><strong>ASM</strong> – bytecode manipulation</li>
                        <li><strong>Byte Buddy</strong> – runtime code generation</li>
                    </ul>
                </li>
                <li>Future: <a href="https://openjdk.org/jeps/484">JEP-484: ClassFile API</a></li>
            </ul>
        </section>

        <section>
            <h2>Annotation Processing</h2>
            <ul>
                <li>Compile-time processors (APT) do not modify classes</li>
                <li><strong>Lombok</strong> abuses compiler internals to mutate AST</li>
                <li>Mutating AST breaks incremental compilation</li>
            </ul>
        </section>

        <section>
            <h2>Dynamic Proxies</h2>
            <ul>
                <li><code>java.lang.reflect.Proxy</code> (interfaces only)</li>
                <li><strong>CGLIB</strong> – subclass proxy (used for classes)</li>
                <li>If bean implements interfaces → JDK proxy</li>
                <li>No interfaces → CGLIB subclass proxy</li>
                <li>Spring uses <a href="https://objenesis.org">Objenesis</a> for object creation</li>
            </ul>
        </section>

        <section>
            <h2>Aspect-Oriented Programming (AOP)</h2>
            <ul>
                <li>Applied via proxies at runtime</li>
                <li>Examples:
                    <ul>
                        <li><code>@Transactional</code></li>
                        <li><code>@Async</code></li>
                        <li><code>@Cacheable</code></li>
                    </ul>
                </li>
                <li><strong>AspectJ</strong> (compile-time or load-time weaving) avoids proxy issues</li>
            </ul>
        </section>

        <section>
            <h2>Proxy Limitations</h2>
            <ul>
                <li>Only <strong>public</strong> method calls go through proxy</li>
                <li><strong>Self-invocation</strong> bypasses proxy → no advice applied</li>
                <li>Private methods are ignored</li>
            </ul>
        </section>

        <section>
            <h2>Common Issues</h2>
            <ul>
                <li>Forgetting <code>@EnableAsync</code> or <code>@EnableCaching</code></li>
                <li>Using Lombok <code>@Data</code> with JPA:
                    <ul>
                        <li>Breaks entity identity</li>
                        <li>Triggers lazy loading unintentionally</li>
                    </ul>
                </li>
                <li>Classpath-based autoconfiguration confusion</li>
            </ul>
        </section>

        <section>
            <h2>Lombok Alternatives for JPA</h2>
            <ul>
                <li>Instead of <code>@Data</code>:
                    <ul>
                        <li><code>@Getter</code>, <code>@Setter</code></li>
                        <li><code>@NoArgsConstructor</code>, <code>@AllArgsConstructor</code></li>
                        <li><code>@ToString(exclude = {"lazyField"})</code></li>
                        <li><code>@EqualsAndHashCode(onlyExplicitlyIncluded = true)</code></li>
                    </ul>
                </li>
            </ul>
        </section>

        <section>
            <h2>Alternatives to Annotation Magic</h2>
            <ul>
                <li><code>@Transactional</code> → <strong>TransactionTemplate</strong></li>
                <li><code>@Async</code> → <strong>CompletableFuture</strong></li>
                <li><code>@Retry</code> → <strong>Resilience4j</strong></li>
                <li><code>@Cacheable</code> → <strong>Caffeine + patterns</strong></li>
            </ul>
        </section>

        <section>
            <h2>Best Practices</h2>
            <ul>
                <li>Prefer constructor injection over setter injection</li>
                <li>Explicit configuration > classpath magic</li>
                <li>Use <code>@Configuration(proxyBeanMethods = false)</code></li>
                <li>Understand lifecycle: <code>@PostConstruct</code> runs after DI</li>
                <li>Debug autoconfiguration when in doubt</li>
            </ul>
        </section>

        <section>
            <h2>Debugging Spring</h2>
            <ul>
                <li>Enable <code>--debug</code> mode</li>
                <li>Spring Boot Actuator</li>
                <li>JetBrains Spring Debugger:
                    <a href="https://www.youtube.com/watch?v=K2tYAHG2XJ8">Watch demo</a>
                </li>
            </ul>
        </section>

        <section>
            <h2>Key Takeaways</h2>
            <ul>
                <li>Spring magic = proxies + reflection + bytecode tricks</li>
                <li>Know limitations: self-invocation, visibility, performance</li>
                <li>Prefer explicit APIs over hidden behavior when possible</li>
            </ul>
        </section>

        <section>
            <h2>Questions?</h2>
        </section>

        <section>
            <blockquote>
                Using common sense is the ultimate Best Practice™.
            </blockquote>
        </section>
        <section>
            <h2>Thank You!</h2>

            <h4><a href="https://twitter.com/pivovarit">@pivovarit</a></h4>
            <small><a href="https://4comprehension.com">4comprehension.com</a></small>
        </section>
    </div>
</div>

<script src="dist/reveal.js"></script>
<script src="plugin/notes/notes.js"></script>
<script src="plugin/markdown/markdown.js"></script>
<script src="plugin/highlight/highlight.js"></script>
<script>
    // More info about initialization & config:
    // - https://revealjs.com/initialization/
    // - https://revealjs.com/config/
    Reveal.initialize({
        hash: true,

        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [RevealMarkdown, RevealHighlight, RevealNotes]
    });

    Reveal.configure({
        controls: false,
    });
</script>
</body>
<style>
    .footer {
        position: fixed;
        bottom: 0;
        width: 98%;
        color: black;
        text-align: right;
        padding: 10px 0px;
        font-size: 60%;
    }
</style>
</html>
