<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Fantastic Frameworks and How to Avoid Them</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/simple.css" id="theme">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
        document.getElementsByTagName('head')[0].appendChild(link);
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
</head>

<body>
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-109711864-1', 'pivovarit.github.io');
    ga('send', 'pageview');

</script>

<div class="reveal">

    <div class="footer">
        <small>Twitter/GitHub: <a href="http://twitter.com/pivovarit">@pivovarit</a></small>
    </div>

    <!-- Any section element inside of this container is displayed as a slide -->
    <div class="slides">

        <section>
            <h1>Fantastic Frameworks</h1>
            <h3>...and How to Avoid Them</h3>
            <br>
            <h2><a href="http://pivovarit.github.io"> Grzegorz Piwowarek</a></h2>
            <h3><a href="http://twitter.com/pivovarit">@pivovarit</a></h3>
        </section>

        <section>
            <h1>Fantastic Frameworks</h1>
            <h3>...and How/Why/If to Avoid Them</h3>
            <br>
            <h2><a href="http://pivovarit.github.io"> Grzegorz Piwowarek</a></h2>
            <h3><a href="http://twitter.com/pivovarit">@pivovarit</a></h3>
        </section>

        <section>
            <h1>{ <a href="http://4comprehension.com/">4comprehension.com</a> }</h1>
            <h2>Lead Engineer @ <a href="https://twitter.com/CasumoTech">CasumoTech</a></h2>
	        <h2>Trainer @ <a href="https://bottega.com.pl">Bottega IT Minds</a></h2>
        </section>

        <section></section>

        <section>
            <h2>Developers Smalltalk?</h2>

            <img src="img/familiada.png" width="80%"/>
            <h2 class="fragment">"What frameworks do you use?" - 100</h2>
        </section>

        <section>
            <blockquote>"Regarding opiniated / unopiniated frameworks, I think they appeal to different types of developers. I now have 20 years of experience. In my first 5-8 years I loved frameworks like Spring. However, as I gained more experience, I felt I needed a framework's "opinion" less and less. Now I avoid them."</blockquote>
            <small>https://www.infoq.com/news/2018/10/the-road-to-micronaut-1.0</small>
        </section>

        <section>
            <img src="img/bosch.jpeg" width="70%" class="fragment"/>
            <div class="fragment">
                <blockquote>"Scala programmer confronts Java project that uses Maven, Spring, and Hibernate" - Salvador Dali, oil painting, 1946</blockquote>
                <small>https://twitter.com/progpaintings/status/723276501081190400</small>
            </div>
        </section>

        <section>
            <h1>I. Invasive Frameworks</h1>
            <div class="fragment">
                <h2>What's an invasive framework?
                </h2>
                <ul>
                </ul>
            </div>
        </section>

        <section>
            <h1>II. Magic</h1>
            <div class="fragment">
                <h2>What's magic?
                </h2>
                <ul>
                    <li>Runtime reflection</li>
                    <li>Classpath scanning</li>
                    <li>Thread-locals</li>
                    <li>Runtime annotation-processing</li>
                    <li>Proxies/AOP</li>
                </ul>
            </div>
            <div class="fragment">
                <img src="img/python.jpg" width="30%"/>
                <br>
                <small>"The Meaning of Life", Monty Python</small>
            </div>

        </section>

        <section>
            *examples of bold promises from java world*
        </section>

        <section>
            <h2>Meanwhile in Scala ecosystem...</h2>
            <br>
            <blockquote>
                (...) It’s not a web-framework but rather a more general toolkit for providing and consuming HTTP-based services.
            </blockquote>
            <small>https://doc.akka.io/docs/akka-http/current/introduction.html#philosophy</small>
        </section>

        <section>
            <img src="img/suffer.png"/>
            <small>http://spiridonov.pro/2015/10/14/scala-implicit-hell/</small>
        </section>

        <section>
            <h2>Frameworks vs Libraries</h2>
        </section>

        <section>
            <h2>Frameworks</h2>

            <ul>
                <li>Take time to learn and outdate quickly</li>
                <li>Own you</li>
                <li>Increase complexity/weight/bloat</li>
                <li>Force you to keep up</li>
                <li>Require expert help</li>
                <li>Probably provide more than you need</li>
            </ul>
        </section>

        <section>
            <h1>Frameworks</h1>
            <h2 class="fragment">Take time to learn and outdate quickly</h2>
            <h2 class="fragment">Own you</h2>
            <h2 class="fragment">Increase complexity/weight</h2>
            <h2 class="fragment">Go out of fashion/get abandoned</h2>
            <h2 class="fragment">Force you to keep up</h2>
            <h2 class="fragment">Require expert help</h2>
            <h2 class="fragment">Probably provide more than you need</h2>
        </section>

        <section>
            <h2>- Wouldn't you like to focus on solving real problems and let framework authors do the boring parts?</h2>
            <h2 class="fragment">- Of course! but...</h2>
            <div class="fragment">
                <blockquote>"All non-trivial abstractions, to some degree, are leaky."</blockquote>
                <small>https://www.joelonsoftware.com/2002/11/11/the-law-of-leaky-abstractions/</small>
            </div>
        </section>


        <section>
            <h2>for example, ORM</h2>
            <small>Hibernate</small>
        </section>

        <section>
            <img src="img/orm.png"/>
            <h4><a href="https://twitter.com/lukaseder/status/1051858654989836288">https://twitter.com/lukaseder/status/1051858654989836288</a></h4>

        </section>

        <section>
            <pre><code data-trim="">
                String sql = create
                  .select(BOOK.TITLE, AUTHOR.FIRST_NAME, AUTHOR.LAST_NAME)
                  .from(BOOK)
                  .join(AUTHOR).on(BOOK.AUTHOR_ID.eq(AUTHOR.ID))
                  .where(BOOK.PUBLISHED_IN.eq(1948))
                  .getSQL();
            </code></pre>
            <h4><a href="https://www.jooq.org/doc/latest/manual-pdf/jOOQ-manual-3.11.pdf">https://www.jooq.org/doc/latest/manual-pdf/jOOQ-manual-3.11.pdf</a></h4>

        </section>

        <section>
            <img src="img/disenchantment.jpg"/>
            <h4><a href="http://tonsky.me/blog/disenchantment/">http://tonsky.me/blog/disenchantment/</a></h4>

        </section>

        <!--field injection vs constructor injection-->

        <section>
            <h1>Spring</h1>
        </section>

        <section>
            <pre><code data-trim="" style="font-size: 0.8em;line-height: 0.9; max-height: 90%">
                import org.springframework.beans.factory.annotation.Autowired;
                import org.springframework.stereotype.Component;

                @Component
                public class FooFacade {

                    @Autowired
                    private FooService fooService;

                    public void foo() {
                        fooService.foo();
                    }
                }
            </code></pre>
            <pre><code data-trim="" style="font-size: 0.8em;line-height: 0.9; max-height: 90%">

                public static void main(String[] args) {
                    new FooFacade(); // ???
                }
            </code></pre>
            <ul>
                <li>- Tight coupling with the DI framework</li>
                <li>- Forces weak encapsulation</li>
                <li>- Forces mutability</li>
            </ul>
        </section>
        <section>
            <pre><code data-trim="" style="font-size: 0.8em;line-height: 0.9; max-height: 90%">
                import org.springframework.beans.factory.annotation.Autowired;
                import org.springframework.stereotype.Component;

                @Component
                public class FooFacade {

                    private final FooService fooService;

                    @Autowired
                    public FooFacade(FooService fooService) {
                        this.fooService = fooService;
                    }

                    public void foo() {
                        fooService.foo();
                    }
                }
            </code></pre>
            <pre><code data-trim="" style="font-size: 0.8em;line-height: 0.9; max-height: 90%">

                public static void main(String[] args) {
                    FooFacade fooFacade = new FooFacade(new FooService());
                }
            </code></pre>
            <ul>
                <li>- Tight coupling with the DI framework</li>
                <li>+ Can be instantiated independently</li>
                <li>+ Internals can be encapsulated</li>
            </ul>
        </section>
        <section>
            <pre><code data-trim="" style="font-size: 0.8em;line-height: 0.9; max-height: 90%">
                // import org.springframework.beans.factory.annotation.Autowired;
                import org.springframework.stereotype.Component;

                @Component
                public class FooFacade {

                    private final FooService fooService;

                    // @Autowired
                    public FooFacade(FooService fooService) {
                        this.fooService = fooService;
                    }

                    public void foo() {
                        fooService.foo();
                    }
                }
            </code></pre>
            <pre><code data-trim="" style="font-size: 0.8em;line-height: 0.9; max-height: 90%">

                public static void main(String[] args) {
                    FooFacade fooFacade = new FooFacade(new FooService());
                }
            </code></pre>
            <ul>
                <li>- Tight coupling with the DI framework</li>
                <li>+ Can be instantiated independently</li>
                <li>+ Internals can be encapsulated</li>
            </ul>
        </section>
        <section>
            <pre><code data-trim="" style="font-size: 0.8em;line-height: 0.9; max-height: 90%">
                public class FooFacade {

                    private final FooService fooService;

                    public FooFacade(FooService fooService) {
                        this.fooService = fooService;
                    }
                }
            </code></pre>
            <pre><code data-trim="" style="font-size: 0.8em;line-height: 0.9; max-height: 90%">
                public static void main(String[] args) {
                    FooFacade fooFacade = new FooFacade(new FooService());
                }

            </code></pre>
            <ul>
                <li>...but where's the config?</li>
            </ul>
        </section>
        <section>
             <pre><code data-trim="" style="font-size: 1em;line-height: 0.9; max-height: 90%">
                import org.springframework.context.annotation.Bean;
                import org.springframework.context.annotation.Configuration;

                @Configuration
                public class FooConfiguration {

                    @Bean
                    FooService fooService() {
                        return new FooService();
                    }

                    @Bean
                    FooFacade fooFacade(FooService fooService) {
                        return new FooFacade(fooService);
                    }
                }
            </code></pre>
            <ul>
                <li>Domain code free of framework configuration</li>
            </ul>
        </section>

        <section>
             <pre><code data-trim="" style="font-size: 1em;line-height: 0.9; max-height: 90%">
                import org.springframework.context.annotation.Bean;
                import org.springframework.context.annotation.Configuration;

                @Configuration
                public class FooConfiguration {

                    @Bean
                    FooFacade fooFacade() {
                        return new FooFacade(new FooService());
                    }
                }
            </code></pre>
            <ul>
                <li>Domain code free of framework configuration</li>
            </ul>
        </section>

        <section>
             <pre><code data-trim="" style="font-size: 0.6em;line-height: 0.9; max-height: 90%">
                import org.springframework.beans.factory.annotation.Autowired;
                import org.springframework.stereotype.Component;

                @Component
                public class FooFacade {

                    @Autowired
                    private FooService fooService;

                    public void foo() {
                        fooService.foo();
                    }
                }
            </code></pre>
            <h2>Same framework both invasive and non-invasive</h2>
            <pre><code data-trim="" style="font-size: 0.6em;line-height: 0.9; max-height: 90%">
                public class FooFacade {

                    private final FooService fooService;

                    public FooFacade(FooService fooService) {
                        this.fooService = fooService;
                    }
                }
            </code></pre>
            <pre><code data-trim="" style="font-size: 0.8em;line-height: 0.9; max-height: 90%">
                import org.springframework.context.annotation.Bean;
                import org.springframework.context.annotation.Configuration;

                @Configuration
                public class FooConfiguration {

                    @Bean
                    FooFacade fooFacade() {
                        return new FooFacade(new FooService());
                    }
                }
            </code></pre>
        </section>

        <section>
            <h2>Pragmatic Hexagonal/Clean Architecture</h2>
        </section>

        <section>
            <h2>Axon RabbitMQ/Kafka Story</h2>
        </section>

        <section>
            <pre><code data-trim="" style="font-size: 0.8em;line-height: 0.9; max-height: 90%">
            import org.axonframework.eventhandling.annotation.EventHandler;

            public class SessionEventsHandler {

                //...

                @EventHandler
                public void handle(SessionStartedEvent event) {
                    // ...
                }

                @EventHandler
                public void handle(SessionEndedEvent event) {
                    // ...
                }
            }
                 </code></pre>
        </section>

       <section>
            <pre><code data-trim="" style="font-size: 0.8em;line-height: 0.9; max-height: 90%">

            @FunctionalInterface
            public interface EventHandler {
                Map&lt;String, EventRoute> getRoutingConfig();
            }
            </code></pre>
        </section>

     <section>
            <pre><code data-trim="" style="font-size: 0.8em;line-height: 0.9; max-height: 90%">

            public class SessionEventsHandler implements EventHandler {

                // ...

                private void playerSessionStarted(SessionStartedEvent event) {
                    // ...
                }

                private void playerSessionEnded(SessionEndedEvent event) {
                    // ...
                }

                @Override
                public Map&lt;String, EventRoute> getRoutingConfig() {
                    return Map.ofEntries(
                      route(
                        SessionEndedEvent.ROUTING_KEY,
                        SessionEndedEvent.class,
                        this::playerSessionEnded),
                      route(
                        SessionStartedEvent.ROUTING_KEY,
                        SessionStartedEvent.class,
                        this::playerSessionStarted)
                    );
                }
            }
            </code></pre>
        </section>

        <section>
            <pre><code data-trim="" style="font-size: 0.7em;line-height: 0.9; max-height: 90%">

            public class RabbitEventStreamListener implements MessageListener {

                // ...

                private final Map&lt;String, EventRoute> eventRoutes;

                @Override
                public void onMessage(Message message) {
                    var route = eventRoutes.get(message.getMessageProperties().getReceivedRoutingKey());
                    if (null != route) {
                        route.getEventHandler().accept(new DomainMessage(...);
                    } else {
                        log.warn("couldn't find a matching routing for routing key");
                    }
                }
            }
            </code></pre>
        </section>

        <section>
            <pre><code data-trim="" style="font-size: 0.7em;line-height: 0.9; max-height: 90%">

            @Configuration
            @Profile("kafka-eventstream")
            public class KafkaEventStreamConfiguration {

                @Bean
                public KafkaEventStreamListener kafkaEventStreamListener(
                  List&lt;EventHandler> handlers, ObjectMapper mapper) {

                    var eventRoutes = handlers.stream()
                      .flatMap(h -> h.getRoutingConfig().entrySet().stream())
                      .collect(
                        groupingBy(Map.Entry::getKey,
                          mapping(Map.Entry::getValue, toUnmodifiableSet())));

                    return new KafkaEventStreamListener(mapper, eventRoutes);
                }
            }
            </code></pre>
        </section>

        <section>
            <pre><code data-trim="" style="font-size: 0.7em;line-height: 0.9; max-height: 90%">

            @Configuration
            @Profile("rabbit-eventstream")
            public class RabbitEventStreamConfiguration {

                @Bean
                public Collection&lt;MessageListenerContainer> rabbitEventStreamListener(
                  @Value("${rabbitmq.axon.exchange}") String axonExchangeName,
                  @Value("${rabbitmq.axon.queuePrefix}") String axonQueuePrefix,
                  AmqpAdmin amqpAdmin,
                  RabbitListenerContainerFactory eventstreamRabbitListenerContainerFactory,
                  List&lt;EventHandler> handlers,
                  ConfigurableBeanFactory beanFactory,
                  ObjectMapper mapper) {

                    TopicExchange axonExchange = new TopicExchange(axonExchangeName);
                    amqpAdmin.declareExchange(axonExchange);

                    return handlers.stream()
                      .map(handler -> buildRabbitListener(...))
                      .collect(toUnmodifiableList());
                }

                private static MessageListenerContainer buildRabbitListener(
                  EventHandler handler,
                  ConfigurableBeanFactory beanFactory,
                  ObjectMapper mapper,
                  String queuePrefix,
                  AmqpAdmin amqpAdmin,
                  TopicExchange axonExchange,
                  RabbitListenerContainerFactory eventstreamRabbitListenerContainerFactory) { ... }
            }
            </code></pre>
        </section>

        <section>
            <blockquote>
                Using common sense is the ultimate Best Practice™.
            </blockquote>

            <blockquote class="fragment">
                Nobody cares if it’s your code or the library you used
            </blockquote>

        </section>

        <section>
            <!--
            Of course when frameworks are working out, then they are just the bees knees. Well, until one day the framework is no longer the cool kid on the block. The community starts to fade. A couple years down the road, colleagues look askance because of a code base that is on a has-been framework.
            Not that big of a problem when doing microservices right


            https://www.youtube.com/watch?v=dGws1pMWzCI
            https://www.youtube.com/watch?v=bEK2Q0AAh6c
            http://kristopherwilson.com/2013/11/27/decoupling-the-framework/
            http://memeagora.blogspot.com/2007/11/ruby-matters-frameworks-dsls-and.html
            https://www.smashingmagazine.com/2017/05/why-no-framework/
            http://www.catonmat.net/blog/frameworks-dont-make-sense/
            http://tomasp.net/blog/2015/library-frameworks/
            https://dzone.com/articles/discussion-recap-to-framework-or-not-to-framework
            https://dev.to/gypsydave5/why-you-shouldnt-use-a-web-framework-3g24
            https://doc.akka.io/docs/akka-http/current/introduction.html#philosophy
            https://www.slideshare.net/debasishg/qconny-12
            https://twitter.com/progpaintings/status/723276501081190400
            Hexagonal Architecture, domain decoupled from infra, Hibernate, Lagom, Event sourcing
            Axon routing




            -->
        </section>

        <section>
            <h2>Thank You!</h2>
            <h4><a href="https://pivovarit.github.io/talks/fantastic-frameworks">https://pivovarit.github.io/talks/fantastic-frameworks</a> </h4>
            <img src="img/talk_qr.png"/>
            <h3><a href="http://twitter.com/pivovarit">@pivovarit</a></h3>
        </section>
    </div>
</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>
    // More info https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
        controls: false,
        defaultTiming: 45,
        progress: true,
        history: true,
        center: true,
        width: 1920,
        height: 1200,
        margin: 0.05,

        transition: 'fade', // none/fade/slide/convex/concave/zoom

        // More info https://github.com/hakimel/reveal.js#dependencies
        dependencies: [
            {
                src: 'lib/js/classList.js', condition: function () {
                    return !document.body.classList;
                }
            },
            {
                src: 'plugin/markdown/marked.js', condition: function () {
                    return !!document.querySelector('[data-markdown]');
                }
            },
            {
                src: 'plugin/markdown/markdown.js', condition: function () {
                    return !!document.querySelector('[data-markdown]');
                }
            },
            {
                src: 'plugin/highlight/highlight.js', async: true, callback: function () {
                    hljs.initHighlightingOnLoad();
                }
            },
            {src: 'plugin/zoom-js/zoom.js', async: true},
            {src: 'plugin/notes/notes.js', async: true}
        ]
    });

</script>

</body>
</html>
