<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Testimonials from companies where Grzegorz Piwowarek delivered workshops and consulting services.">
    <title>Testimonials - Grzegorz Piwowarek</title>
    <link href="testimonials.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;600;700&family=Roboto+Slab:wght@300;400;700&display=swap" rel="stylesheet">

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3HB1PH886Z"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-3HB1PH886Z');
    </script>
</head>

<body>

<div>
    <main class="content">
        <header class="page-header">
            <h1 class="page-title">Testimonials</h1>
            <p class="page-subtitle">Feedback from workshops and consulting engagements</p>
            <button id="opinionsBtn" class="opinions-btn">View Participant Opinions</button>
        </header>

        <div id="opinionsModal" class="modal" role="dialog" aria-labelledby="modalTitle" aria-hidden="true">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalTitle" class="modal-title">Participant Opinions<span id="opinionCount" class="opinion-count"></span></h2>
                    <button id="closeModal" class="modal-close" aria-label="Close modal">&times;</button>
                </div>
                <div id="opinionsContainer" class="opinions-container"></div>
            </div>
        </div>

        <div id="testimonialsGrid" class="testimonials-grid" role="region" aria-label="Testimonials">
        </div>
    </main>

    <footer class="site-footer" role="contentinfo">
        <small>&copy; <span id="copyrightYear"></span> Grzegorz Piwowarek. All rights reserved.</small>
    </footer>
</div>

<script>
    document.getElementById("copyrightYear").textContent = new Date().getFullYear();

    const grid = document.getElementById('testimonialsGrid');
    let testimonials = [];

    function getInitials(name) {
        return name.split(' ').map(n => n[0]).join('').toUpperCase();
    }

    function renderTestimonials() {
        if (testimonials.length === 0) {
            grid.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">&#128172;</div>
                    <p>No testimonials found.</p>
                </div>
            `;
            return;
        }

        grid.innerHTML = testimonials.map(t => `
            <article class="testimonial-card">
                <blockquote class="testimonial-quote">${t.quote}</blockquote>
                <div class="testimonial-author">
                    <div class="author-avatar">${getInitials(t.author)}</div>
                    <div class="author-info">
                        <p class="author-name">${t.author}</p>
                        <p class="author-title">${t.title}, <span class="author-company">${t.company}</span></p>
                    </div>
                </div>
                ${t.tags && t.tags.length ? `<div class="testimonial-tags">${t.tags.map(tag => `<span class="testimonial-tag">${tag}</span>`).join('')}</div>` : ''}
            </article>
        `).join('');
    }

    fetch('testimonials.json')
        .then(res => res.json())
        .then(data => {
            testimonials = data;
            renderTestimonials();
        })
        .catch(err => {
            console.error('Failed to load testimonials:', err);
            grid.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">!</div>
                    <p>Failed to load testimonials.</p>
                </div>
            `;
        });

    const modal = document.getElementById('opinionsModal');
    const opinionsBtn = document.getElementById('opinionsBtn');
    const closeModal = document.getElementById('closeModal');
    const opinionsContainer = document.getElementById('opinionsContainer');
    const opinionCount = document.getElementById('opinionCount');

    function renderOpinions(opinions) {
        if (!opinions || opinions.length === 0) {
            opinionCount.textContent = '';
            opinionsContainer.innerHTML = '<p class="no-opinions">No participant opinions available.</p>';
            return;
        }
        opinionCount.textContent = `(${opinions.length})`;
        opinionsContainer.innerHTML = opinions.map(o => `
            <article class="opinion-card">
                <div class="opinion-meta">
                    <span class="opinion-workshop">${o.workshop}</span>
                    <span class="opinion-date">${o.date}</span>
                </div>
                <p class="opinion-text">${o.opinion}</p>
            </article>
        `).join('') + '<button class="scroll-top-btn" aria-label="Scroll to top">â†‘ Back to top</button>';
    }

    opinionsContainer.addEventListener('click', (e) => {
        if (e.target.classList.contains('scroll-top-btn')) {
            opinionsContainer.scrollTo({ top: 0, behavior: 'smooth' });
        }
    });

    opinionsContainer.addEventListener('scroll', () => {
        const btn = opinionsContainer.querySelector('.scroll-top-btn');
        if (btn) {
            if (opinionsContainer.scrollTop > 300) {
                btn.classList.add('visible');
            } else {
                btn.classList.remove('visible');
            }
        }
    });

    function openModal() {
        modal.classList.add('active');
        modal.setAttribute('aria-hidden', 'false');
        document.body.style.overflow = 'hidden';
        opinionsContainer.scrollTop = 0;
    }

    function closeModalFn() {
        modal.classList.remove('active');
        modal.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = '';
    }

    opinionsBtn.addEventListener('click', () => {
        fetch('opinions.json')
            .then(res => res.json())
            .then(data => {
                renderOpinions(data);
                openModal();
            })
            .catch(err => {
                console.error('Failed to load opinions:', err);
                opinionsContainer.innerHTML = '<p class="no-opinions">Failed to load opinions.</p>';
                openModal();
            });
    });

    closeModal.addEventListener('click', closeModalFn);
    modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModalFn();
    });
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modal.classList.contains('active')) closeModalFn();
    });
</script>

</body>
</html>
