<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Testimonials from companies where Grzegorz Piwowarek delivered workshops and consulting services.">
    <title>Testimonials - Grzegorz Piwowarek</title>
    <link href="testimonials.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3HB1PH886Z"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-3HB1PH886Z');
    </script>
</head>

<body>

<canvas id="bg-canvas"></canvas>

<div>
    <main class="content">
        <header class="page-header">
            <a href="/" class="back-link">← pivovarit.github.io</a>
            <h1 class="page-title">Testimonials</h1>
            <p class="page-subtitle">Workshops · Consulting · Mentoring</p>
            <div class="divider" style="margin-top: 1.5rem; margin-bottom: 0;"></div>
            <button id="opinionsBtn" class="opinions-btn" style="margin-top: 1.5rem;">View Participant Opinions</button>
        </header>

        <div id="opinionsModal" class="modal" role="dialog" aria-labelledby="modalTitle" aria-hidden="true">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalTitle" class="modal-title">Participant Opinions<span id="opinionCount" class="opinion-count"></span></h2>
                    <button id="closeModal" class="modal-close" aria-label="Close modal">&times;</button>
                </div>
                <div id="opinionsContainer" class="opinions-container"></div>
            </div>
        </div>

        <div id="testimonialsGrid" class="testimonials-grid" role="region" aria-label="Testimonials">
        </div>
    </main>

    <footer class="site-footer" role="contentinfo">
        <small>&copy; <span id="copyrightYear"></span> Grzegorz Piwowarek. All rights reserved.</small>
    </footer>
</div>

<script>
    document.getElementById("copyrightYear").textContent = new Date().getFullYear();

    const grid = document.getElementById('testimonialsGrid');
    let testimonials = [];

    function getInitials(name) {
        return name.split(' ').map(n => n[0]).join('').toUpperCase();
    }

    function renderTestimonials() {
        if (testimonials.length === 0) {
            grid.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">&#128172;</div>
                    <p>No testimonials found.</p>
                </div>
            `;
            return;
        }

        grid.innerHTML = testimonials.map(t => `
            <article class="testimonial-card">
                <blockquote class="testimonial-quote">${t.quote}</blockquote>
                <div class="testimonial-author">
                    <div class="author-avatar">${getInitials(t.author)}</div>
                    <div class="author-info">
                        <p class="author-name">${t.author}</p>
                        <p class="author-title">${t.title}, <span class="author-company">${t.company}</span></p>
                    </div>
                </div>
                ${t.tags && t.tags.length ? `<div class="testimonial-tags">${t.tags.map(tag => `<span class="testimonial-tag">${tag}</span>`).join('')}</div>` : ''}
            </article>
        `).join('');
    }

    fetch('testimonials.json')
        .then(res => res.json())
        .then(data => {
            testimonials = data;
            renderTestimonials();
        })
        .catch(err => {
            console.error('Failed to load testimonials:', err);
            grid.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">!</div>
                    <p>Failed to load testimonials.</p>
                </div>
            `;
        });

    const modal = document.getElementById('opinionsModal');
    const opinionsBtn = document.getElementById('opinionsBtn');
    const closeModal = document.getElementById('closeModal');
    const opinionsContainer = document.getElementById('opinionsContainer');
    const opinionCount = document.getElementById('opinionCount');

    function renderOpinions(opinions) {
        if (!opinions || opinions.length === 0) {
            opinionCount.textContent = '';
            opinionsContainer.innerHTML = '<p class="no-opinions">No participant opinions available.</p>';
            return;
        }
        opinionCount.textContent = `(${opinions.length})`;
        opinionsContainer.innerHTML = opinions.map((o, i) => `
            <article class="opinion-card">
                <div class="opinion-meta">
                    <span class="opinion-workshop">${o.workshop}</span>
                    <span class="opinion-date">${o.date}</span>
                </div>
                <p class="opinion-text" data-translated="${o.opinion}"${o.original ? ` data-original="${o.original.replace(/"/g, '&quot;')}"` : ''}>${o.opinion}</p>
                ${o.original ? `<button class="lang-toggle-btn" data-index="${i}" aria-pressed="false">translated</button>` : ''}
            </article>
        `).join('') + '<button class="scroll-top-btn" aria-label="Scroll to top">↑ Back to top</button>';
    }

    opinionsContainer.addEventListener('click', (e) => {
        if (e.target.classList.contains('scroll-top-btn')) {
            opinionsContainer.scrollTo({ top: 0, behavior: 'smooth' });
        }
        if (e.target.classList.contains('lang-toggle-btn')) {
            const btn = e.target;
            const card = btn.closest('.opinion-card');
            const textEl = card.querySelector('.opinion-text');
            const isShowingOriginal = btn.getAttribute('aria-pressed') === 'true';
            if (isShowingOriginal) {
                textEl.textContent = textEl.dataset.translated;
                btn.textContent = 'translated';
                btn.setAttribute('aria-pressed', 'false');
            } else {
                textEl.textContent = textEl.dataset.original;
                btn.textContent = 'original';
                btn.setAttribute('aria-pressed', 'true');
            }
        }
    });

    opinionsContainer.addEventListener('scroll', () => {
        const btn = opinionsContainer.querySelector('.scroll-top-btn');
        if (btn) {
            if (opinionsContainer.scrollTop > 300) {
                btn.classList.add('visible');
            } else {
                btn.classList.remove('visible');
            }
        }
    });

    function openModal() {
        modal.classList.add('active');
        modal.setAttribute('aria-hidden', 'false');
        document.body.style.overflow = 'hidden';
        opinionsContainer.scrollTop = 0;
    }

    function closeModalFn() {
        modal.classList.remove('active');
        modal.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = '';
    }

    opinionsBtn.addEventListener('click', () => {
        fetch('opinions.json')
            .then(res => res.json())
            .then(data => {
                for (let i = data.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [data[i], data[j]] = [data[j], data[i]];
                }
                renderOpinions(data);
                openModal();
            })
            .catch(err => {
                console.error('Failed to load opinions:', err);
                opinionsContainer.innerHTML = '<p class="no-opinions">Failed to load opinions.</p>';
                openModal();
            });
    });

    closeModal.addEventListener('click', closeModalFn);
    modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModalFn();
    });
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modal.classList.contains('active')) closeModalFn();
    });
</script>

<script>
    (function() {
        const canvas = document.getElementById('bg-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        let mouse = { x: null, y: null, radius: 150 };
        let animationId;
        const baseConnectionDistance = 120;

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            initParticles();
        }

        function initParticles() {
            particles = [];
            const particleCount = Math.floor((canvas.width * canvas.height) / 12000);
            for (let i = 0; i < particleCount; i++) {
                const depth = Math.random() * 0.7 + 0.3;
                const baseVelocity = (Math.random() - 0.5) * 0.4;
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    baseX: 0,
                    baseY: 0,
                    vx: baseVelocity * depth,
                    vy: ((Math.random() - 0.5) * 0.4) * depth,
                    size: (Math.random() * 2 + 1) * depth,
                    alpha: (Math.random() * 0.4 + 0.25) * depth,
                    depth: depth
                });
                particles[i].baseX = particles[i].x;
                particles[i].baseY = particles[i].y;
            }
            particles.sort((a, b) => a.depth - b.depth);
        }

        function drawConnections() {
            for (let i = 0; i < particles.length; i++) {
                for (let j = i + 1; j < particles.length; j++) {
                    const depthDiff = Math.abs(particles[i].depth - particles[j].depth);
                    if (depthDiff > 0.25) continue;

                    const dx = particles[i].x - particles[j].x;
                    const dy = particles[i].y - particles[j].y;
                    const dist = Math.sqrt(dx * dx + dy * dy);

                    const avgDepth = (particles[i].depth + particles[j].depth) / 2;
                    const connectionDist = baseConnectionDistance * avgDepth;

                    if (dist < connectionDist) {
                        const opacity = (1 - dist / connectionDist) * 0.2 * avgDepth;
                        ctx.beginPath();
                        ctx.moveTo(particles[i].x, particles[i].y);
                        ctx.lineTo(particles[j].x, particles[j].y);
                        ctx.strokeStyle = `rgba(255, 255, 255, ${opacity})`;
                        ctx.lineWidth = 0.8 * avgDepth;
                        ctx.stroke();
                    }
                }
            }
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            particles.forEach(p => {
                p.baseX += p.vx;
                p.baseY += p.vy;

                if (p.baseX < 0) { p.baseX = canvas.width; p.x = canvas.width; }
                if (p.baseX > canvas.width) { p.baseX = 0; p.x = 0; }
                if (p.baseY < 0) { p.baseY = canvas.height; p.y = canvas.height; }
                if (p.baseY > canvas.height) { p.baseY = 0; p.y = 0; }

                let targetX = p.baseX;
                let targetY = p.baseY;

                if (mouse.x !== null && mouse.y !== null) {
                    const dx = p.baseX - mouse.x;
                    const dy = p.baseY - mouse.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);

                    const effectiveRadius = mouse.radius * p.depth;
                    if (dist < effectiveRadius) {
                        const force = (effectiveRadius - dist) / effectiveRadius;
                        const angle = Math.atan2(dy, dx);
                        targetX = p.baseX + Math.cos(angle) * force * 30 * p.depth;
                        targetY = p.baseY + Math.sin(angle) * force * 30 * p.depth;
                    }
                }

                p.x += (targetX - p.x) * 0.1;
                p.y += (targetY - p.y) * 0.1;
            });

            drawConnections();

            particles.forEach(p => {
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(255, 255, 255, ${p.alpha})`;
                ctx.fill();
            });

            animationId = requestAnimationFrame(animate);
        }

        window.addEventListener('resize', resize);

        document.addEventListener('mousemove', (e) => {
            mouse.x = e.clientX;
            mouse.y = e.clientY;
        });

        document.addEventListener('mouseleave', () => {
            mouse.x = null;
            mouse.y = null;
        });

        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                cancelAnimationFrame(animationId);
            } else {
                animate();
            }
        });

        resize();
        animate();
    })();
</script>

</body>
</html>
